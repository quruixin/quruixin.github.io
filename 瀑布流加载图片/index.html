<!DOCTYPE HTML>
<html>
<head>
    <title>瀑布流</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="../jquery-1.8.3.min.js"></script>
    <style>
        *{padding:0;margin:0;}
        .box{position:relative;float:left;}
        .content{padding:10px;border:1px solid #ccc;box-shadow: 0 0 5px;border-radius: 5px;}
        .content img{width:190px;}
    </style>
</head>
<body>
<div id="container">
    <div class="box">
        <div class="content">
            <img src="images/1.jpg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/2.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/3.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/4.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/5.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/6.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/7.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/8.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/9.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/10.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/11.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/12.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/13.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/14.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/15.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/16.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/17.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/18.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/19.png" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/20.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/21.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/22.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/23.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/24.jpeg" alt="">
        </div>
    </div>
    <div class="box">
        <div class="content">
            <img src="images/25.jpeg" alt="">
        </div>
    </div>

</div>
</body>
<script>
    $(document).ready(function(){
        $(window).on('load',function(){
            imgLocation();
            var dataImg={'data':[
                {'src':'1.jpg'},
                {'src':'2.jpeg'},
                {'src':'3.jpeg'},
                {'src':'4.jpeg'},
                {'src':'5.jpeg'},
                {'src':'6.jpeg'},
                {'src':'7.jpeg'},
                {'src':'8.jpeg'},
                {'src':'9.jpeg'},
                {'src':'10.jpeg'},
                {'src':'11.jpeg'},
                {'src':'12.jpeg'},
                {'src':'13.jpeg'},
                {'src':'14.jpeg'},
                {'src':'15.jpeg'},
                {'src':'16.jpeg'},
                {'src':'17.jpeg'},
                {'src':'18.jpeg'},
                {'src':'19.jpeg'},
                {'src':'20.jpeg'},
                {'src':'21.jpeg'},
                {'src':'22.jpeg'},
                {'src':'17.jpeg'},
            ]};
            window.onscroll=function(){
                if(scrollSide()){
                    $.each(dataImg.data,function(index,value){
                        var box=$('<div>').addClass('box').appendTo($('#container'));
                        var content=$('<div>').addClass('content').appendTo(box);
                        $('<img>').attr('src','./images/'+$(value).attr('src')).appendTo(content);
                    })
                    imgLocation();
                }
            };
        });
    });
    function scrollSide(){
        var box=$('.box');
        var lastBoxHeight=box.last().get(0).offsetTop+Math.floor(box.last().height()/2);
        var documentHeight=$(document).width();
        var scrollHeight=$(window).scrollTop();
        return (lastBoxHeight<scrollHeight+documentHeight)?true:false;
    }
    function imgLocation(){
        var box=$('.box');
        var boxWidth=box.eq(0).width();
        var num=Math.floor($(window).width()/boxWidth);
        var boxArr=[];
        box.each(function(index,value){
            var boxHeight=box.eq(index).height();
            if(index<num){
                boxArr[index]=boxHeight;
            }else{
                var minboxHeight=Math.min.apply(null,boxArr);
                var minboxIndex=$.inArray(minboxHeight,boxArr);
                $(value).css({
                    "position":"absolute",
                    "top":minboxHeight,
                    "left":box.eq(minboxIndex).position().left
                });
                boxArr[minboxIndex]+=box.eq(index).height();
            }
        })
    }
</script>
</html>